<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mestres de Aluguel RPG - Portal da Guilda</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #121212; color: #ccc; font-family: 'Lato', sans-serif; line-height: 1.6; min-height: 100vh; }

        h1, h2, h3, .cta-button, header a {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            color: #D4AF37;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        header { background-color: #1a1a1a; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #D4AF37; }
        header .logo { font-size: 1.8em; text-decoration: none; text-transform: uppercase; }
        header nav a { font-size: 1em; text-decoration: none; margin-left: 20px; padding: 5px 10px; border: 1px solid transparent; }
        header nav a:hover { color: #fff; border-color: #D4AF37; }

        .container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; text-align: center; }

        .hero { padding: 60px 0; }
        .hero h1 { font-size: 3.5em; margin-bottom: 20px; }
        .hero .subtitle { font-size: 1.2em; color: #fff; max-width: 600px; margin: 0 auto 30px auto; }

        .cta-button { display: inline-block; background-color: #D4AF37; color: #1a1a1a; padding: 15px 30px; border-radius: 5px; font-size: 1.1em; border: none; cursor: pointer; }
        .cta-button.secondary { background-color: transparent; color: #D4AF37; border: 2px solid #D4AF37; }

        .steps { background-color: #1a1a1a; padding: 40px; border-radius: 8px; margin: 40px 0; }

        .aventuras h2 { font-size: 2.5em; margin-bottom: 30px; }

        .mesas-container { display: flex; justify-content: center; gap: 25px; }
        .mesa-card { background-color: #1a1a1a; border: 2px solid #D4AF37; border-radius: 8px; padding: 20px; width: 300px; }

        .success-message {
            display: none;
            background-color: #28a745;
            color: #fff;
            padding: 15px 30px;
            border-radius: 5px;
            margin-top: 20px;
        }

        footer { text-align: center; padding: 30px; margin-top: 40px; background-color: #1a1a1a; border-top: 1px solid #333; }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo">Mestres de Aluguel RPG</a>
    <nav>
        <a href="#aventuras">Ver Mesas</a>
        <a href="https://discord.gg/d9Ym4P9zNw" target="_blank">Comunidade</a>
    </nav>
</header>

<main>

    <div class="hero container">
        <h1>O PORTAL DA GUILDA</h1>
        <p class="subtitle">Autentique-se com o Discord para acessar as mesas.</p>

        <a href="/auth/discord" class="cta-button secondary" id="auth-button">
            Autenticar com Discord
        </a>

        <div id="welcome-message" style="display:none;">
            <h2>Saudações, <span id="username">Aventureiro</span>!</h2>
        </div>
    </div>

    <div class="aventuras container" id="aventuras" style="display:none;">
        <h2>Mesas Disponíveis</h2>

        <div class="success-message" id="success-message">
            ✅ Pagamento confirmado!
        </div>

        <div class="mesas-container">
            <div class="mesa-card">
                <h3>Curse of Strahd: Reloaded</h3>
                <p>Mestre: Arboreal</p>
                <p>Sistema: D&D 5e</p>
                <p>Horário: Sextas</p>

                <button class="cta-button"
                    onclick="criarSessao(
                        '1443344623908032603',
                        'Curse of Strahd: Reloaded'
                    )">
                    Forjar Assinatura (R$ 130/mês)
                </button>
            </div>
        </div>
    </div>

</main>

<footer>
    <p>© 2025 Mestres de Aluguel RPG</p>
</footer>

<script>
window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status');
    const username = urlParams.get('username');
    const discord_id = urlParams.get('discord_id');

    if (username && discord_id) {
        document.getElementById('auth-button').style.display = 'none';
        document.getElementById('welcome-message').style.display = 'block';
        document.getElementById('username').textContent = username;
        document.getElementById('aventuras').style.display = 'block';
    }

    if (status === 'success') {
        document.getElementById('success-message').style.display = 'block';
    }
};

async function criarSessao(idCargoDiscord, nomeAventura) {
    const urlParams = new URLSearchParams(window.location.search);
    const discordId = urlParams.get('discord_id');

    const response = await fetch('/create-checkout-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            discordId,
            idCargoDiscord,
            nomeAventura
        })
    });

    const data = await response.json();
    window.location.href = data.url;
}
</script>

</body>
</html>
